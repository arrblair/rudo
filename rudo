#!/usr/local/bin/ruby
require 'rubygems'
require 'dm-core'
require 'dm-migrations'
require 'dm-aggregates'
require 'task'
require 'list'

# uncomment the following line to see database output
#DataMapper::Logger.new($stdout, :debug)
# DataMapper is an ORM, we're using sqlite, cause it's easy
DataMapper.setup(:default, 'sqlite://' + File.expand_path('~/todo.db'))
DataMapper.finalize
DataMapper.auto_upgrade!

# believe it or not, it all starts here
begin
  if ARGV[0]
    if ARGV[1]
      # send tries to call the method with the name in ARGV[0]
      List.send(ARGV[0], ARGV[1])
    else
      List.send(ARGV[0])
    end
  end
  List.print_tasks
rescue NoMethodError => ex
  # catch the error where List doesn't have the method from ARGV[0]
  puts "X"*40
  puts "no such option, try 'add', 'done', or 'walk'"
  puts "X"*40
rescue Exception => ex
  # catch and print errors raised by the call to List
  puts "X"*40
  puts ex.message
  puts "X"*40
end

